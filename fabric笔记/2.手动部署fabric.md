# 手动部署fabric

##  生成证书文件

1. 创建项目目录
2. 编写crypto-config.yame，也可能是别的名字。确定组织架构
3. 根据组织架构生成所有用户的证书

        cryptogen generate --config=crypto-config.yaml

    默认会在项目中创建crypto-config文件夹，存放所有证书。

## 生成初始化文件

1. 编写configtx.yaml文件，必须为此名字
2. 创建文件夹channel-artifacts,用来存储这些中间过程文件
3. 创建order的初始块

        configtxgen -profile ItcastOrdererGenesis -outputBlock ./channel-artifacts/genesis.block

4. 创建channel文件

        configtxgen -profile ItcastOrgsChannel -outputCreateChannelTx ./channel-artifacts/channel.tx -channelID itcastchannel

5. 创建锚点更新文件

        configtxgen -profile ItcastOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/GoMSPanchors.tx -channelID itcastchannel -asOrg OrgGoMSP

注意：1个组织创建1个。锚节点是负责组织间交互的节点（anchor peer）锚节点只能有1个。

## 在docker中启动服务

1. 编写docker-compose的配置文件：ocker-compose.yaml
2. 启动docker服务：

        docker-compose up -d

    -d 代表后台启动
    -f 可指定自定义名称的配置文件。

## 进入容器，连接服务

1. 进容器：

        docker exec -it cli /bin/bash

2. 连接服务

        peer channel create -o orderer.itcast.com:7050 -c itcastchannel -f ./channel-artifacts/channel.tx --tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/itcast.com/msp/tlscacerts/tlsca.itcast.com-cert.pem

## 注意事项

若更新docker映射的目录，请重启docker服务，并清除映射缓存！！！！

    docker-compose -f docker-compose-cli.yaml down --volumes --remove-orphans

    docker rm -f $(docker ps -a | grep "hyperledger/*" | awk "{print \$1}")
    docker volume prune
