# 数据管理

容器数据持久化及互通共享

## 数据卷

数据卷是容器内数据直接映射到本地主机环境的一种实现方式。

### 创建数据卷

启动时创建

docker run -itd --name [给容器起名] -v  [宿主机目录]:[容器目录] [镜像名称] [可选命令]

注意 宿主机目录为绝对路径

### 文件式数据卷】

不仅目录可以映射，文件也可以，但不推荐。
 
 ## 数据卷容器

 使用专门的容器做数据卷，这个容器就是数据卷容器

 注意： 数据卷容器不需启动即可使用。启动也没毛病，但不需要。
 
 ### 创建数据卷容器

 docker create -v [容器数据卷目录] --name[给容器起名] [镜像名称] [可选命令]

 可以看出，不需要映射本地目录，直接是:后面的部分。

 ### 使用数据卷容器

 在创建新的容器时，可以指定已经创建好的数据卷容器

 docker run --volumes-from [数据卷容器id或名字] -tid --name  --name[给容器起名] [镜像名称] [可选命令]

 ## 数据备份

注意前提：数据卷容器的作用是容器与容器之间数据交互的通道，是没有跟本地建立映射的。故思路如下。
备份思路：创建一个专门的备份容器，映射数据卷容器内的数据，到宿主机，完成数据压缩存入宿主机，容器自动删除。

1. 创建挂在数据卷容器的容器
2. 挂在宿主机本地目录作为备份数据卷
3. 将数据卷容器的内容备份到宿主机本地目录挂载的数据卷中
4. 完成备份操作后销毁备份容器

docker run --rm --volumes-from  [数据卷容器id或名字] -v  [宿主机目录]:[容器目录] [镜像名称] [备份命令]

备份命令示例：tar zcPf [宿主机目录]/xxxx.tar.gz /[要压缩的容器目录]


